
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <style>
                body {
                  background-color: white; /* Ensure the iframe has a white background */
                }

                
              </style>
                        </head>
                        <body>
                            <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel de Mesero</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); min-height: 100vh; padding: 16px; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 20px; border-radius: 16px; margin-bottom: 24px; }
    .header-content h1 { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
    .header-content p { font-size: 14px; opacity: 0.9; }
    .tabs { display: flex; overflow-x: auto; padding: 8px 0; margin-bottom: 24px; background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .tab-btn { padding: 12px 24px; border: none; background: none; font-size: 16px; font-weight: 600; color: #6b7280; cursor: pointer; border-radius: 8px; white-space: nowrap; margin: 0 4px; }
    .tab-btn.active { background: #dbeafe; color: #1d4ed8; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: white; border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .error { text-align: center; padding: 40px; color: #ef4444; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <h1 id="meseroNombre">Cargando Panel...</h1>
        <p id="tenantInfo">Verificando acceso...</p>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="mesas">ü™ë Mesas</button>
      <button class="tab-btn" data-tab="menu">üçé Men√∫</button>
      <button class="tab-btn" data-tab="carrito">üõí Carrito</button>
      <button class="tab-btn" data-tab="pedidos">üìã Pedidos</button>
      <button class="tab-btn" data-tab="pagos">üí∞ Pagos</button>
      <button class="tab-btn" data-tab="dj">üéµ DJ</button>
    </div>

    <div id="contentArea">
      <div class="card">
        <p style="text-align: center;">Cargando datos del mesero...</p>
      </div>
    </div>
  </div>

  <!-- Firebase SDK (solo para operaciones, no para autenticaci√≥n) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCYuZRqdrR4ZcQ97T6lU8vIqFw58cSM4hA",
      authDomain: "manager-pro-ec292.firebaseapp.com",
      projectId: "manager-pro-ec292",
      storageBucket: "manager-pro-ec292.firebasestorage.app",
      messagingSenderId: "1077289364014",
      appId: "1:1077289364014:web:a6bcea3c7ea2923ad4cdbf"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Variables globales
    let currentMesero = null;
    let currentTenantId = null;

    // ‚úÖ Extraer datos de la URL (m√©todo nuclear)
    function getMeseroData() {
      const params = new URLSearchParams(window.location.search);
      const dataParam = params.get('data');
      if (!dataParam) return null;
      
      try {
        const decoded = decodeURIComponent(dataParam);
        const jsonStr = atob(decoded);
        return JSON.parse(jsonStr);
      } catch (e) {
        console.error('Error al decodificar datos:', e);
        return null;
      }
    }

    // Inicializaci√≥n
    async function init() {
      try {
        const data = getMeseroData();
        if (!data || !data.meseroId || !data.tenantId) {
          throw new Error('URL inv√°lida. Acceda desde el panel de administraci√≥n.');
        }

        // ‚úÖ CONF√çA EN LOS DATOS DEL ADMIN (ya autenticado)
        currentMesero = {
          id: data.meseroId,
          nombre: data.meseroNombre
        };
        currentTenantId = data.tenantId;

        document.getElementById('meseroNombre').textContent = `Panel de ${currentMesero.nombre}`;
        document.getElementById('tenantInfo').textContent = `Tenant: ${currentTenantId.substring(0, 8)}...`;

        // Cargar el contenido real del cashier
        loadCashierContent();
      } catch (error) {
        document.getElementById('contentArea').innerHTML = `
          <div class="card error">
            <h2>‚ùå Acceso Denegado</h2>
            <p>${error.message}</p>
            <button onclick="window.location.href='index.html'" 
                    style="margin-top: 20px; background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">
              Volver al Login
            </button>
          </div>
        `;
      }
    }

    // ‚úÖ Cargar el contenido del cashier (separado para claridad)
    function loadCashierContent() {
      document.getElementById('contentArea').innerHTML = `
        <!-- Mesas Tab -->
        <div class="tab-content active" id="tab-mesas">
          <div class="card">
            <h2>ü™ë Selecci√≥n de Mesa</h2>
            <p>Selecciona la mesa que deseas atender</p>
            <div id="mesasContainer">
              <p style="text-align: center; color: #6b7280;">Cargando mesas...</p>
            </div>
          </div>
        </div>
        <!-- Resto del contenido igual que antes -->
        <div class="tab-content" id="tab-menu"><div class="card"><h2>üçé Men√∫ de Bebidas</h2><div id="menuContainer"><p style="text-align: center; color: #6b7280;">Cargando men√∫...</p></div></div></div>
        <div class="tab-content" id="tab-carrito"><div class="card"><h2>üõí Carrito de Pedidos</h2><div id="carritoContainer"><p style="text-align: center; color: #6b7280;">Carrito vac√≠o</p></div></div></div>
        <div class="tab-content" id="tab-pedidos"><div class="card"><h2>üìã Pedidos Activos</h2><div id="pedidosContainer"><p style="text-align: center; color: #6b7280;">No hay pedidos activos</p></div></div></div>
        <div class="tab-content" id="tab-pagos"><div class="card"><h2>üí∞ Registro de Pagos</h2><div id="pagosContainer"><p style="text-align: center; color: #6b7280;">Listo para procesar pagos</p></div></div></div>
        <div class="tab-content" id="tab-dj">
          <div class="card">
            <h2>üéµ Solicitar Canciones al DJ</h2>
            <div class="form-group">
              <label for="cancionInput">Nombre de la Canci√≥n *</label>
              <input type="text" id="cancionInput" placeholder="Despacito" required>
            </div>
            <div class="form-group">
              <label for="artistaInput">Artista (opcional)</label>
              <input type="text" id="artistaInput" placeholder="Luis Fonsi">
            </div>
            <button class="submit-btn" onclick="solicitarCancion()" style="background: linear-gradient(135deg, #4c1d95 0%, #7e22ce 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;">Enviar al DJ</button>
            <div id="djContainer" style="margin-top: 20px;"><p style="text-align: center; color: #6b7280;">Listo para enviar peticiones</p></div>
          </div>
        </div>
      `;

      // Configurar tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          this.classList.add('active');
          document.getElementById('tab-' + this.getAttribute('data-tab')).classList.add('active');
        });
      });

      // Cargar datos de Firestore (ahora sabemos el tenantId)
      cargarMesas(currentTenantId);
      cargarArticulos(currentTenantId);
    }

    // Funciones de Firestore (igual que antes, pero sin autenticaci√≥n)
    async function cargarMesas(tenantId) {
      try {
        const mesasSnapshot = await db.collection(`tenants/${tenantId}/mesas`).get();
        const mesas = [];
        mesasSnapshot.forEach(doc => mesas.push({ id: doc.id, ...doc.data() }));
        renderMesas(mesas);
      } catch (error) {
        document.getElementById('mesasContainer').innerHTML = `<p style="text-align: center; color: #ef4444;">Error: ${error.message}</p>`;
      }
    }

    async function cargarArticulos(tenantId) {
      try {
        const articulosSnapshot = await db.collection(`tenants/${tenantId}/articulos`).get();
        const articulos = [];
        articulosSnapshot.forEach(doc => articulos.push({ id: doc.id, ...doc.data() }));
        renderMenu(articulos);
      } catch (error) {
        document.getElementById('menuContainer').innerHTML = `<p style="text-align: center; color: #ef4444;">Error: ${error.message}</p>`;
      }
    }

    // Render functions (same as before) [OMITIDAS POR BREVEDAD, PERO SON LAS MISMAS]

    // Funciones globales (igual que antes)
    function seleccionarMesa(mesaId, mesaNumero) {
      // ... igual ...
    }
    
    function agregarAlCarrito(articuloId, nombre, precio) {
      // ... igual ...
    }
    
    // ... otras funciones ...

    // Iniciar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>



              <script>
                              window.copiarURL = function(meseroId, meseroNombre, tenantId) {
  // Codificar los datos en la URL
  const datos = btoa(JSON.stringify({
    meseroId,
    meseroNombre,
    tenantId
  }));
  const url = `${window.location.origin}/cashier.html?data=${encodeURIComponent(datos)}`;
  navigator.clipboard.writeText(url).then(() => {
    alert('‚úÖ URL copiada!\n' + url);
  });
};

<div class="action-buttons">
  <button class="action-btn copy" onclick="copiarURL('${mesero.id}', '${mesero.nombre}', '${tenantId}')">Copiar URL</button>
  <button class="action-btn whatsapp" onclick="enviarWhatsAppMesero('${mesero.nombre}', '${mesero.telefono}', '${mesero.id}', '${tenantId}')">WhatsApp</button>
  <button class="action-btn" style="background: #ef4444; color: white;" onclick="eliminarMesero('${mesero.id}')">Eliminar</button>
</div>

window.enviarWhatsAppMesero = function(nombre, telefono, meseroId, tenantId) {
  const datos = btoa(JSON.stringify({
    meseroId,
    meseroNombre: nombre,
    tenantId
  }));
  const url = `${window.location.origin}/cashier.html?data=${encodeURIComponent(datos)}`;
  const mensaje = `Hola ${nombre}, accede aqu√≠: ${url}`;
  window.open(`https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`, '_blank');
};


              </script>
                        </body>
                        </html>
                    